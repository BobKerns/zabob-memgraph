# Simplified test Dockerfile - uses pre-built base-test image
ARG BASE_IMAGE_REGISTRY=ghcr.io
ARG BASE_IMAGE_NAME=bobkerns/zabob-memgraph
ARG BASE_IMAGE_VERSION=v9

FROM ${BASE_IMAGE_REGISTRY}/${BASE_IMAGE_NAME}/base-test:${BASE_IMAGE_VERSION}

WORKDIR /app

# Copy source code
COPY memgraph/ ./memgraph/

# Build web bundle
RUN pnpm run build:web

# Copy test files and configuration
COPY tests/ ./tests/
COPY pyproject.toml ./

# Copy test runner script
COPY devtool ./devtool
COPY .dev-library/zabob/tools/ ./.dev-library/zabob/tools/
RUN chmod +x ./devtool

# Set up environment for test execution
ENV PYTHONPATH=/app

# Default command runs all quality checks and tests
ENTRYPOINT ["/app/devtool", "code", "all"]
