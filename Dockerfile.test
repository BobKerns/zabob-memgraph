# Simplified test Dockerfile - uses pre-built base-test image
ARG BASE_IMAGE_REGISTRY=ghcr.io
ARG BASE_IMAGE_NAME=bobkerns/zabob-memgraph
ARG BASE_IMAGE_VERSION=v1

FROM ${BASE_IMAGE_REGISTRY}/${BASE_IMAGE_NAME}/base-test:${BASE_IMAGE_VERSION}

WORKDIR /app

# Copy source code
COPY memgraph/ ./memgraph/

# Build web bundle
RUN pnpm run build:web

# Copy test files and configuration
COPY tests/ ./tests/
COPY pyproject.toml check_types.py dev_utils.py ./

# Copy test runner script
COPY run-all-tests.sh /app/run-all-tests.sh
RUN chmod +x /app/run-all-tests.sh

# Set up environment for test execution
ENV PYTHONPATH=/app
WORKDIR /app

# Default command runs all quality checks and tests
CMD ["/app/run-all-tests.sh"]
